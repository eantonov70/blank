<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaMask Auth Example</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
<h1>Авторизация через MetaMask</h1>
<button id="connectButton">Подключить MetaMask</button>
<button id="disconnectButton" style="display:none;">Отключить MetaMask</button>
<h2>Баланс: <span id="balance">0 BNB</span></h2>

<script>
    const connectButton = document.getElementById('connectButton');
    const disconnectButton = document.getElementById('disconnectButton');
    const balanceDisplay = document.getElementById('balance');

    let web3;
    let userAccount;

    // Проверка наличия MetaMask
    if (typeof window.ethereum !== 'undefined') {
        web3 = new Web3(window.ethereum);
    } else {
        alert('Пожалуйста, установите MetaMask!');
    }

    // Подключение к MetaMask
    connectButton.addEventListener('click', async () => {
        try {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            userAccount = accounts[0];
            connectButton.style.display = 'none';
            disconnectButton.style.display = 'block';
            updateBalance();
        } catch (error) {
            console.error(error);
        }
    });

    // Отключение MetaMask
    disconnectButton.addEventListener('click', () => {
        userAccount = null;
        connectButton.style.display = 'block';
        disconnectButton.style.display = 'none';
        balanceDisplay.innerText = '0 BNB';
    });

    // Обновление баланса пользователя
    async function updateBalance() {
        if (userAccount) {
            const balanceWei = await web3.eth.getBalance(userAccount);
            const balance = web3.utils.fromWei(balanceWei, 'ether');
            balanceDisplay.innerText = `${balance} BNB`;
        }
    }

    // Установка провайдера на тестовую сеть BSC
    const bscTestnetUrl = 'https://data-seed-prebsc-1-s1.binance.org:8545/';
    web3.setProvider(new Web3.providers.HttpProvider(bscTestnetUrl));
</script>
</body>
</html>